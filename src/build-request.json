{
  "kind": "build_request",
  "title": "Add in-app personalization for copy, photos, and background music",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-11",
      "text": "Add an in-page “Customize” panel that lets the user personalize the site copy (hero name/heading/subheading, story text, reasons list, love letter text, surprise message, footer name/text) at runtime without code changes.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-3"
        ],
        "quotes": [
          "Want to personalize the copy and images, and to add music and all"
        ]
      },
      "acceptanceCriteria": [
        "A “Customize” entry point is available on the page (e.g., a small floating button or a top-of-page link) and opens a panel/modal/drawer.",
        "The panel exposes editable fields for the main text content across all sections (Hero, Our Story, Reasons, Love Letter, Surprise, Footer).",
        "Edits are immediately reflected in the rendered page after saving/applying changes.",
        "A “Reset to defaults” action restores the original values from frontend/src/config/valentineContent.ts."
      ]
    },
    {
      "id": "REQ-12",
      "text": "Persist personalization changes locally in the browser so that customized copy remains after a refresh (use localStorage; no backend persistence).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-3"
        ],
        "quotes": [
          "Want to personalize the copy and images, and to add music and all"
        ]
      },
      "acceptanceCriteria": [
        "After customizing and refreshing the page, the customized values are restored automatically.",
        "Reset clears the saved customization and reverts to the default config values.",
        "The site still works normally if localStorage is unavailable or cleared (falls back to defaults)."
      ]
    },
    {
      "id": "REQ-13",
      "text": "Add image personalization: allow the user to replace gallery images (and optionally hero background/accent image if present) by selecting local image files in the “Customize” panel; show previews and use the selected images in the Gallery section.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-3"
        ],
        "quotes": [
          "Want to personalize the copy and images, and to add music and all"
        ]
      },
      "acceptanceCriteria": [
        "The Customize panel includes controls to replace each Gallery item image via a local file picker.",
        "Selected images preview correctly in the panel and render in the Gallery grid in place of the placeholders.",
        "Selections persist across refresh via localStorage (e.g., stored as data URLs) and can be reset to defaults.",
        "If a selected image fails to load, the UI gracefully falls back to the default placeholder image."
      ]
    },
    {
      "id": "REQ-14",
      "text": "Add music personalization: allow the user to add background music either by (a) setting a static local asset path in config (existing valentineContent.surprise.musicPath) or (b) selecting a local audio file in the “Customize” panel; ensure playback is user-initiated and provide play/pause controls after reveal.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-3"
        ],
        "quotes": [
          "Want to personalize the copy and images, and to add music and all"
        ]
      },
      "acceptanceCriteria": [
        "A local audio file can be selected in the Customize panel and used as the Surprise section’s music source.",
        "Music playback only starts as a result of an explicit user interaction (e.g., clicking the Surprise reveal button or pressing Play).",
        "After the surprise is revealed, the UI provides Play/Pause controls and reflects the current playing state.",
        "Music selection persists across refresh via localStorage and can be reset to the default valentineContent.surprise.musicPath behavior.",
        "If no music is available (no file selected and the configured path is missing), the UI shows a clear placeholder/instructional message (English)."
      ]
    }
  ],
  "constraints": [
    "Do not edit files under frontend/src/hooks/useInternetIdentity.ts, frontend/src/hooks/useInternetIdentity.tsx, frontend/src/hooks/useActor.ts, frontend/src/main.tsx, or anything under frontend/src/components/ui (compose instead of modifying).",
    "Keep the backend as a single Motoko actor; do not add backend storage for personalization.",
    "Do not introduce third-party auth providers; Internet Identity remains the only auth option (not required for this feature).",
    "Audio autoplay must not occur without user interaction; handle browser autoplay restrictions gracefully."
  ],
  "nonGoals": [
    "No multi-device sync of personalized content.",
    "No server/canister-side upload or storage of user images/audio.",
    "No real-time collaboration or sharing links for customized versions."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}